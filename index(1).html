<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Zombie Wave Survival</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #111; overflow: hidden; font-family: Arial, sans-serif; touch-action: none; }
  canvas { display: block; }

  /* HUD - –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
  #hud {
    position: fixed; top: 0; left: 0; width: 100%;
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 12px; background: rgba(0,0,0,0.7);
    color: #fff; font-size: 16px; z-index: 10;
  }
  #hud .hp { color: #f44; }
  #hud .wave { color: #fa0; }
  #hud .kills { color: #4f4; }

  /* –ö–Ω–æ–ø–∫–∞ mute */
  #muteBtn {
    position: fixed; top: 8px; right: 12px;
    background: rgba(255,255,255,0.15); border: none;
    color: #fff; font-size: 20px; padding: 4px 10px;
    border-radius: 8px; cursor: pointer; z-index: 20;
  }

  /* –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–∞ / –∫–æ–Ω—Ü–∞ */
  #screen {
    position: fixed; inset: 0; background: rgba(0,0,0,0.85);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    color: #fff; z-index: 30;
  }
  #screen h1 { font-size: 36px; color: #f44; text-shadow: 0 0 20px #f00; margin-bottom: 16px; }
  #screen p { font-size: 18px; color: #aaa; margin-bottom: 8px; }
  #screen button {
    margin-top: 24px; padding: 14px 40px;
    font-size: 20px; background: #c00; color: #fff;
    border: none; border-radius: 12px; cursor: pointer;
    box-shadow: 0 0 20px #f00;
  }
  #screen button:hover { background: #f00; }

  /* –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  #controls {
    position: fixed; bottom: 0; left: 0; width: 100%;
    display: none; /* –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
    z-index: 10; pointer-events: none;
  }

  /* –î–∂–æ–π—Å—Ç–∏–∫ —Å–ª–µ–≤–∞ */
  #joystickZone {
    position: fixed; bottom: 20px; left: 20px;
    width: 130px; height: 130px;
    pointer-events: all;
  }
  #joystickBase {
    width: 130px; height: 130px;
    background: rgba(255,255,255,0.1);
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    position: relative;
  }
  #joystickKnob {
    width: 55px; height: 55px;
    background: rgba(255,255,255,0.4);
    border-radius: 50%;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
  }

  /* –ö–Ω–æ–ø–∫–∞ —Å—Ç—Ä–µ–ª—å–±—ã —Å–ø—Ä–∞–≤–∞ */
  #shootBtn {
    position: fixed; bottom: 30px; right: 30px;
    width: 80px; height: 80px;
    background: rgba(200,0,0,0.7);
    border: 3px solid #f44;
    border-radius: 50%;
    font-size: 30px;
    display: flex; align-items: center; justify-content: center;
    pointer-events: all; user-select: none;
  }

  /* –ö–Ω–æ–ø–∫–∞ –ø–∞—É–∑—ã */
  #pauseBtn {
    position: fixed; bottom: 30px; right: 130px;
    width: 55px; height: 55px;
    background: rgba(255,255,255,0.15);
    border: 2px solid rgba(255,255,255,0.4);
    border-radius: 50%;
    font-size: 22px;
    display: flex; align-items: center; justify-content: center;
    pointer-events: all; user-select: none; color: #fff;
  }
</style>
</head>
<body>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ö–æ–ª—Å—Ç –∏–≥—Ä—ã -->
<canvas id="gameCanvas"></canvas>

<!-- HUD (—Å—á—ë—Ç, –∂–∏–∑–Ω–∏, –≤–æ–ª–Ω–∞) -->
<div id="hud">
  <span class="hp">‚ù§Ô∏è <span id="hpVal">100</span></span>
  <span class="wave">üåä –í–æ–ª–Ω–∞: <span id="waveVal">1</span></span>
  <span class="kills">üíÄ <span id="killsVal">0</span></span>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫–∞ -->
<button id="muteBtn">üîä</button>

<!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–∞ -->
<div id="screen">
  <h1>üßü ZOMBIE SURVIVAL</h1>
  <p>–í—ã–∂–∏–≤–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –¥–æ–ª—å—à–µ!</p>
  <p style="font-size:14px;color:#666;">–ü–ö: WASD + –º—ã—à—å | –¢–µ–ª–µ—Ñ–æ–Ω: –¥–∂–æ–π—Å—Ç–∏–∫ + –∫–Ω–æ–ø–∫–∞</p>
  <button id="startBtn">‚ñ∂ –ò–ì–†–ê–¢–¨</button>
</div>

<!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
<div id="controls">
  <div id="joystickZone">
    <div id="joystickBase">
      <div id="joystickKnob"></div>
    </div>
  </div>
  <div id="shootBtn">üî´</div>
  <div id="pauseBtn">‚è∏</div>
</div>

<script>
// ===== –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´ =====
const PLAYER_SPEED = 3;
const BULLET_SPEED = 7;
const ZOMBIE_BASE_SPEED = 0.8;
const ZOMBIE_HP = 3;
const PLAYER_MAX_HP = 100;
const ZOMBIE_DAMAGE = 10;
const SHOOT_COOLDOWN = 300; // –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –≤—ã—Å—Ç—Ä–µ–ª–∞–º–∏

// ===== –ó–í–£–ö–ò (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Web Audio API) =====
let audioCtx = null;
let muted = false;
let audioStarted = false;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function initAudio() {
  if (audioStarted) return;
  audioStarted = true;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}

// –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ—Å—Ç–æ–π –∑–≤—É–∫ –≤—ã—Å—Ç—Ä–µ–ª–∞
function playShoot() {
  if (muted || !audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.frequency.setValueAtTime(800, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.1);
  gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
  osc.start(); osc.stop(audioCtx.currentTime + 0.1);
}

// –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ —É–¥–∞—Ä–∞ –ø–æ –∑–æ–º–±–∏
function playHit() {
  if (muted || !audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = 'sawtooth';
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.frequency.setValueAtTime(150, audioCtx.currentTime);
  gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);
  osc.start(); osc.stop(audioCtx.currentTime + 0.15);
}

// –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ —Å–º–µ—Ä—Ç–∏ –∏–≥—Ä–æ–∫–∞
function playDeath() {
  if (muted || !audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = 'square';
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.frequency.setValueAtTime(400, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
  gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
  osc.start(); osc.stop(audioCtx.currentTime + 0.5);
}

// ===== –•–û–õ–°–¢ =====
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ö–æ–ª—Å—Ç–∞ –ø–æ–¥ —ç–∫—Ä–∞–Ω
function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// ===== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ =====
let gameRunning = false;
let paused = false;
let player, bullets, zombies, kills, wave, waveTimer, lastShot;
let keys = {}; // –Ω–∞–∂–∞—Ç—ã–µ –∫–ª–∞–≤–∏—à–∏
let mouse = { x: 0, y: 0, shooting: false };
let joystick = { dx: 0, dy: 0, active: false, startX: 0, startY: 0 };

// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ =====
function initGame() {
  player = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    r: 18, // —Ä–∞–¥–∏—É—Å
    hp: PLAYER_MAX_HP,
    angle: 0 // –∫—É–¥–∞ —Å–º–æ—Ç—Ä–∏—Ç
  };
  bullets = [];
  zombies = [];
  kills = 0;
  wave = 1;
  waveTimer = 0;
  lastShot = 0;
  spawnWave();
  updateHUD();
}

// ===== –°–ü–ê–í–ù –í–û–õ–ù–´ –ó–û–ú–ë–ò =====
function spawnWave() {
  const count = 5 + wave * 2; // —Å –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω–æ–π –∑–æ–º–±–∏ –±–æ–ª—å—à–µ
  for (let i = 0; i < count; i++) {
    spawnZombie();
  }
}

// –°–æ–∑–¥–∞—ë–º –æ–¥–Ω–æ–≥–æ –∑–æ–º–±–∏ –Ω–∞ –∫—Ä–∞—é —ç–∫—Ä–∞–Ω–∞
function spawnZombie() {
  const side = Math.floor(Math.random() * 4);
  let x, y;
  if (side === 0) { x = Math.random() * canvas.width; y = -30; }
  else if (side === 1) { x = canvas.width + 30; y = Math.random() * canvas.height; }
  else if (side === 2) { x = Math.random() * canvas.width; y = canvas.height + 30; }
  else { x = -30; y = Math.random() * canvas.height; }

  zombies.push({
    x, y,
    r: 16,
    hp: ZOMBIE_HP + Math.floor(wave / 2), // –∑–æ–º–±–∏ –∫—Ä–µ–ø—á–µ —Å –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω–æ–π
    speed: ZOMBIE_BASE_SPEED + wave * 0.05,
    flashTimer: 0 // –º–∏–≥–∞–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏
  });
}

// ===== –í–´–°–¢–†–ï–õ =====
function shoot(targetX, targetY) {
  const now = Date.now();
  if (now - lastShot < SHOOT_COOLDOWN) return;
  lastShot = now;

  // –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –∫ —Ü–µ–ª–∏
  const angle = Math.atan2(targetY - player.y, targetX - player.x);
  bullets.push({
    x: player.x,
    y: player.y,
    vx: Math.cos(angle) * BULLET_SPEED,
    vy: Math.sin(angle) * BULLET_SPEED,
    r: 5
  });
  playShoot();
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ì–†–´ (–∫–∞–∂–¥—ã–π –∫–∞–¥—Ä) =====
function update() {
  if (!gameRunning || paused) return;

  // --- –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ ---
  let dx = 0, dy = 0;

  // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ WASD –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏
  if (keys['w'] || keys['arrowup'])    dy -= PLAYER_SPEED;
  if (keys['s'] || keys['arrowdown'])  dy += PLAYER_SPEED;
  if (keys['a'] || keys['arrowleft'])  dx -= PLAYER_SPEED;
  if (keys['d'] || keys['arrowright']) dx += PLAYER_SPEED;

  // –î–∂–æ–π—Å—Ç–∏–∫ (–º–æ–±–∏–ª—å–Ω—ã–π)
  if (joystick.active) {
    dx += joystick.dx * PLAYER_SPEED;
    dy += joystick.dy * PLAYER_SPEED;
  }

  // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
  if (dx !== 0 && dy !== 0) { dx *= 0.707; dy *= 0.707; }

  // –î–≤–∏–≥–∞–µ–º –∏–≥—Ä–æ–∫–∞, –Ω–µ –≤—ã—Ö–æ–¥—è –∑–∞ —ç–∫—Ä–∞–Ω
  player.x = Math.max(player.r, Math.min(canvas.width - player.r, player.x + dx));
  player.y = Math.max(player.r, Math.min(canvas.height - player.r, player.y + dy));

  // –£–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏–≥—Ä–æ–∫–∞ –∫ –º—ã—à–∏
  player.angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);

  // –°—Ç—Ä–µ–ª—å–±–∞ –ø–æ –º—ã—à–∏ (–ü–ö)
  if (mouse.shooting) {
    shoot(mouse.x, mouse.y);
  }

  // --- –î–≤–∏–∂–µ–Ω–∏–µ –ø—É–ª—å ---
  for (let i = bullets.length - 1; i >= 0; i--) {
    const b = bullets[i];
    b.x += b.vx;
    b.y += b.vy;

    // –£–¥–∞–ª—è–µ–º –ø—É–ª—é –µ—Å–ª–∏ –≤—ã—à–ª–∞ –∑–∞ —ç–∫—Ä–∞–Ω
    if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
      bullets.splice(i, 1);
      continue;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –∑–æ–º–±–∏
    let hit = false;
    for (let j = zombies.length - 1; j >= 0; j--) {
      const z = zombies[j];
      const dist = Math.hypot(b.x - z.x, b.y - z.y);
      if (dist < b.r + z.r) {
        z.hp--;
        z.flashTimer = 5; // –º–∏–≥–∞–Ω–∏–µ
        playHit();
        bullets.splice(i, 1);
        hit = true;
        if (z.hp <= 0) {
          zombies.splice(j, 1);
          kills++;
          updateHUD();
        }
        break;
      }
    }
  }

  // --- –î–≤–∏–∂–µ–Ω–∏–µ –∑–æ–º–±–∏ –∫ –∏–≥—Ä–æ–∫—É ---
  for (let i = zombies.length - 1; i >= 0; i--) {
    const z = zombies[i];
    if (z.flashTimer > 0) z.flashTimer--;

    const angle = Math.atan2(player.y - z.y, player.x - z.x);
    z.x += Math.cos(angle) * z.speed;
    z.y += Math.sin(angle) * z.speed;

    // –ó–æ–º–±–∏ –∫–∞—Å–∞–µ—Ç—Å—è –∏–≥—Ä–æ–∫–∞ ‚Äî —É—Ä–æ–Ω
    const dist = Math.hypot(z.x - player.x, z.y - player.y);
    if (dist < z.r + player.r) {
      player.hp -= ZOMBIE_DAMAGE * 0.016; // —É—Ä–æ–Ω –∑–∞ –∫–∞–¥—Ä
      updateHUD();
      if (player.hp <= 0) {
        gameOver();
        return;
      }
    }
  }

  // --- –°–ª–µ–¥—É—é—â–∞—è –≤–æ–ª–Ω–∞ –∫–æ–≥–¥–∞ —É–±–∏—Ç—ã –≤—Å–µ –∑–æ–º–±–∏ ---
  if (zombies.length === 0) {
    waveTimer++;
    if (waveTimer > 120) { // 2 —Å–µ–∫—É–Ω–¥—ã –ø–∞—É–∑—ã
      wave++;
      waveTimer = 0;
      spawnWave();
      updateHUD();
    }
  }
}

// ===== –û–¢–†–ò–°–û–í–ö–ê =====
function draw() {
  // –§–æ–Ω ‚Äî —Ç—ë–º–Ω–∞—è —Ç—Ä–∞–≤–∞
  ctx.fillStyle = '#1a2a1a';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // –°–µ—Ç–∫–∞ –Ω–∞ —Ñ–æ–Ω–µ
  ctx.strokeStyle = 'rgba(255,255,255,0.04)';
  ctx.lineWidth = 1;
  for (let x = 0; x < canvas.width; x += 40) {
    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
  }
  for (let y = 0; y < canvas.height; y += 40) {
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
  }

  if (!gameRunning) return;

  // --- –†–∏—Å—É–µ–º –ø—É–ª–∏ ---
  ctx.fillStyle = '#ff0';
  for (const b of bullets) {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
    ctx.fill();
  }

  // --- –†–∏—Å—É–µ–º –∑–æ–º–±–∏ ---
  for (const z of zombies) {
    // –¢–µ–ª–æ –∑–æ–º–±–∏
    ctx.fillStyle = z.flashTimer > 0 ? '#fff' : '#4a8a4a';
    ctx.beginPath();
    ctx.arc(z.x, z.y, z.r, 0, Math.PI * 2);
    ctx.fill();

    // –ì–ª–∞–∑–∞ –∑–æ–º–±–∏
    ctx.fillStyle = '#f00';
    ctx.beginPath();
    ctx.arc(z.x - 5, z.y - 4, 4, 0, Math.PI * 2);
    ctx.arc(z.x + 5, z.y - 4, 4, 0, Math.PI * 2);
    ctx.fill();

    // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –Ω–∞–¥ –∑–æ–º–±–∏
    const maxHp = ZOMBIE_HP + Math.floor(wave / 2);
    const hpRatio = z.hp / maxHp;
    ctx.fillStyle = '#333';
    ctx.fillRect(z.x - z.r, z.y - z.r - 8, z.r * 2, 4);
    ctx.fillStyle = hpRatio > 0.5 ? '#4f4' : '#f84';
    ctx.fillRect(z.x - z.r, z.y - z.r - 8, z.r * 2 * hpRatio, 4);
  }

  // --- –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞ ---
  ctx.save();
  ctx.translate(player.x, player.y);
  ctx.rotate(player.angle);

  // –¢–µ–ª–æ
  ctx.fillStyle = '#4af';
  ctx.beginPath();
  ctx.arc(0, 0, player.r, 0, Math.PI * 2);
  ctx.fill();

  // –°—Ç–≤–æ–ª –ø—É—à–∫–∏
  ctx.fillStyle = '#89c';
  ctx.fillRect(0, -5, player.r + 8, 10);

  ctx.restore();

  // –ù–∞–¥–ø–∏—Å—å "–°–ª–µ–¥—É—é—â–∞—è –≤–æ–ª–Ω–∞"
  if (zombies.length === 0 && gameRunning) {
    ctx.fillStyle = 'rgba(255,200,0,0.8)';
    ctx.font = 'bold 28px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('üåä –°–ª–µ–¥—É—é—â–∞—è –≤–æ–ª–Ω–∞...', canvas.width / 2, canvas.height / 2);
  }
}

// ===== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ =====
function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï HUD =====
function updateHUD() {
  document.getElementById('hpVal').textContent = Math.max(0, Math.round(player.hp));
  document.getElementById('waveVal').textContent = wave;
  document.getElementById('killsVal').textContent = kills;
}

// ===== –ö–û–ù–ï–¶ –ò–ì–†–´ =====
function gameOver() {
  gameRunning = false;
  playDeath();
  const screen = document.getElementById('screen');
  screen.innerHTML = `
    <h1>üíÄ –í–´ –ü–û–ì–ò–ë–õ–ò</h1>
    <p>–í–æ–ª–Ω–∞: ${wave}</p>
    <p>–£–±–∏—Ç–æ –∑–æ–º–±–∏: ${kills}</p>
    <button id="startBtn">üîÑ –ó–ê–ù–û–í–û</button>
  `;
  screen.style.display = 'flex';
  document.getElementById('startBtn').addEventListener('click', startGame);
}

// ===== –°–¢–ê–†–¢ –ò–ì–†–´ =====
function startGame() {
  initAudio();
  document.getElementById('screen').style.display = 'none';
  gameRunning = true;
  paused = false;
  initGame();
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
  if ('ontouchstart' in window) {
    document.getElementById('controls').style.display = 'block';
    document.getElementById('joystickZone').style.display = 'block';
    document.getElementById('shootBtn').style.display = 'flex';
    document.getElementById('pauseBtn').style.display = 'flex';
  }
}

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–õ–ê–í–ò–ê–¢–£–†–û–ô =====
document.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
});
document.addEventListener('keyup', e => {
  keys[e.key.toLowerCase()] = false;
});

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–´–®–¨–Æ =====
canvas.addEventListener('mousemove', e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});
canvas.addEventListener('mousedown', e => {
  initAudio();
  if (e.button === 0) mouse.shooting = true;
});
canvas.addEventListener('mouseup', e => {
  if (e.button === 0) mouse.shooting = false;
});

// ===== –ú–û–ë–ò–õ–¨–ù–´–ô –î–ñ–û–ô–°–¢–ò–ö =====
const joystickZone = document.getElementById('joystickZone');
const joystickKnob = document.getElementById('joystickKnob');
const maxDist = 40; // –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–¥–≤–∏–≥ —Ä—É—á–∫–∏

joystickZone.addEventListener('touchstart', e => {
  e.preventDefault();
  const t = e.touches[0];
  const rect = joystickZone.getBoundingClientRect();
  joystick.startX = rect.left + rect.width / 2;
  joystick.startY = rect.top + rect.height / 2;
  joystick.active = true;
}, { passive: false });

joystickZone.addEventListener('touchmove', e => {
  e.preventDefault();
  const t = e.touches[0];
  let dx = t.clientX - joystick.startX;
  let dy = t.clientY - joystick.startY;
  const dist = Math.hypot(dx, dy);
  if (dist > maxDist) { dx = dx/dist*maxDist; dy = dy/dist*maxDist; }
  joystick.dx = dx / maxDist;
  joystick.dy = dy / maxDist;
  // –î–≤–∏–≥–∞–µ–º —Ä—É—á–∫—É –¥–∂–æ–π—Å—Ç–∏–∫–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ
  joystickKnob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
}, { passive: false });

joystickZone.addEventListener('touchend', e => {
  e.preventDefault();
  joystick.active = false;
  joystick.dx = 0; joystick.dy = 0;
  joystickKnob.style.transform = 'translate(-50%, -50%)';
}, { passive: false });

// ===== –ö–ù–û–ü–ö–ê –°–¢–†–ï–õ–¨–ë–´ (–º–æ–±–∏–ª—å–Ω–∞—è) =====
const shootBtn = document.getElementById('shootBtn');
let mobileShooting = false;
shootBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  mobileShooting = true;
  // –°—Ç—Ä–µ–ª—è–µ–º –≤ —Å–ª—É—á–∞–π–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –≤–æ–∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞ (–∞–≤—Ç–æ–ø—Ä–∏—Ü–µ–ª –∫ –±–ª–∏–∂–∞–π—à–µ–º—É –∑–æ–º–±–∏)
  function mobileShootLoop() {
    if (!mobileShooting) return;
    let target = { x: player.x + Math.cos(player.angle)*100, y: player.y + Math.sin(player.angle)*100 };
    // –ê–≤—Ç–æ–ø—Ä–∏—Ü–µ–ª –∫ –±–ª–∏–∂–∞–π—à–µ–º—É –∑–æ–º–±–∏
    let minDist = Infinity;
    for (const z of zombies) {
      const d = Math.hypot(z.x - player.x, z.y - player.y);
      if (d < minDist) { minDist = d; target = z; }
    }
    shoot(target.x, target.y);
    setTimeout(mobileShootLoop, SHOOT_COOLDOWN);
  }
  mobileShootLoop();
}, { passive: false });
shootBtn.addEventListener('touchend', e => { e.preventDefault(); mobileShooting = false; }, { passive: false });

// ===== –ö–ù–û–ü–ö–ê –ü–ê–£–ó–´ =====
document.getElementById('pauseBtn').addEventListener('click', () => {
  paused = !paused;
  document.getElementById('pauseBtn').textContent = paused ? '‚ñ∂' : '‚è∏';
});

// ===== –ö–ù–û–ü–ö–ê MUTE =====
document.getElementById('muteBtn').addEventListener('click', () => {
  muted = !muted;
  document.getElementById('muteBtn').textContent = muted ? 'üîá' : 'üîä';
});

// ===== –°–¢–ê–†–¢ =====
document.getElementById('startBtn').addEventListener('click', startGame);
gameLoop(); // –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª —Å—Ä–∞–∑—É (—Ñ–æ–Ω —Ä–∏—Å—É–µ—Ç—Å—è)
</script>
</body>
</html>
